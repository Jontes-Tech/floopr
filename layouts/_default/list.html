{{ partial "header.html" . }}

<h1>{{ replace .Title "SLASH" "/"}}</h1>
<script>
function change(rpl) {
  // RPL stands for Relative Permalink
  let a = document.getElementById("audiop-"+rpl);
  if (!a.paused){
    document.getElementById("playbtn-"+rpl).innerHTML = a.paused ? '<svg style="width:24px;height:24px" viewBox="0 0 24 24"><path fill="currentColor" d="M14,19H18V5H14M6,19H10V5H6V19Z" /></svg>' : '<svg style="width:24px;height:24px" viewBox="0 0 24 24"><path fill="currentColor" d="M8,5.14V19.14L19,12.14L8,5.14Z" /></svg>'
    a.pause()
  }
  else {
    let audioElements = document.getElementsByTagName('audio');
    let playbtns = document.getElementsByTagName("button");
    
    for (let i = 0; i < playbtns.length; i++) {
      playbtns[i].innerHTML = '<svg style="width:24px;height:24px" viewBox="0 0 24 24"><path fill="currentColor" d="M8,5.14V19.14L19,12.14L8,5.14Z" /></svg>'
    }
    for (let i = 0; i < audioElements.length; i++) {
      audioElements[i].pause();
      document.getElementById("playbtn-"+rpl).innerHTML = a.paused ? '<svg style="width:24px;height:24px" viewBox="0 0 24 24"><path fill="currentColor" d="M14,19H18V5H14M6,19H10V5H6V19Z" /></svg>' : '<svg style="width:24px;height:24px" viewBox="0 0 24 24"><path fill="currentColor" d="M8,5.14V19.14L19,12.14L8,5.14Z" /></svg>'
}
  a.play() 
}
}
</script>
{{$url := cond hugo.IsProduction
"https://cdn.jsdelivr.net/gh/Jontes-Tech/floopr@master/static" ""}}
<div class="flex flex-col min-h-screen">
<div class="container">
  <noscript>
    <div class="block sm:hidden shadow-lg bg-stone-700 rounded-lg py-5 px-6 mb-4 text-base text-gray-100 border-4 border-red-600">
      This webapp works better with JavaScript.
    </div>
  </noscript>
  <div class="block sm:hidden shadow-lg bg-stone-700 rounded-lg py-5 px-6 mb-4 text-base text-gray-100 border-4 border-red-600">
    Your screen is too small! You may need to horizontally scroll.
  </div>
  <div class="overflow-x-auto relative shadow-2xl rounded-lg outline-red-700">
    <table class="w-full text-sm text-left text-gray-400 bg-slate-900">
      <thead class="text-xs uppercase bg-neutral-700 text-gray-400">
        <tr>
          <th scope="col" class="py-3 px-4">Title</th>
          <th scope="col" class="py-3 px-4">Contributor</th>
          <th scope="col" class="py-3 px-4">Time Signature</th>
          <th scope="col" class="py-3 px-4">Tempo</th>
          <th scope="col" class="py-3 px-4">Type</th>
          <th scope="col" class="py-3 px-4">Key</th>
          <th scope="col" class="py-3 px-4">Play</th>
          <th scope="col" class="py-3 px-4">Download</th>
        </tr>
      </thead>
      <tbody>
        {{ range .Paginator.Pages }}
        <tr class="border-b border-neutral-700 bg-neutral-800">
          <th scope="row" class="py-4 px-6 font-medium whitespace-nowrap text-white">
            <a href={{.RelPermalink}}>{{.Title}}</a>
          </th>
          <td class="py-4 px-6">{{range .Params.authors}}<a href="{{ "/authors/" | relLangURL }}{{ . | urlize }}">{{ .
          }}</a> {{end}}</td>
          <td class="py-4 px-6">{{ if .Params.timesig }}<a href="{{ "/timesig/" | relLangURL }}{{ .Params.timesig |
            lower}}">{{ replace .Params.timesig "SLASH" "/"}}</a>{{end}}</td>
            <td class="py-4 px-6">{{ if .Params.tempo }}<a href="{{ "/tempo/" | relLangURL }}{{ .Params.tempo | urlize
            }}">{{ .Params.tempo }} BPM</a>{{end}}</td>
            <td class="py-4 px-6">{{ if .Params.type }}<a href="{{ "/type/" | relLangURL }}{{ .Params.type }}">{{
              .Params.type }}</a>{{end}}</td>
              <td class="py-4 px-6">{{ if .Params.key }}<a href="{{ "/key/" | relLangURL }}{{ .Params.key }}">{{
                .Params.key }}</a>{{end}}</td>
              <td class="py-4 px-6"><button id="playbtn-{{.RelPermalink}}"
                onclick="change('{{.RelPermalink}}')"><svg style="width:24px;height:24px" viewBox="0 0 24 24">
                  <path fill="currentColor" d="M8,5.14V19.14L19,12.14L8,5.14Z" />
                </svg></button><audio id='audiop-{{.RelPermalink}}' loop><source src='{{$url}}/audio/{{.Page.File.Dir}}{{.Page.File.BaseFileName}}{{if eq .Params.type "midi"}}.audio{{end}}'></audio><noscript><audio id='audiop' controls loop><source src='{{$url}}/audio/{{.Page.File.Dir}}{{.Page.File.BaseFileName}}{{if eq .Params.type "midi"}}.audio{{end}}'></audio></noscript>
              </td>
              <td class="py-4 px-6"><a href="{{$url}}/audio/{{.Page.File.Dir}}{{.Page.File.BaseFileName}}" download="floopr-{{.Page.File.BaseFileName}}"><svg style="width:24px;height:24px" viewBox="0 0 24 24">
                <path fill="currentColor" d="M5,20H19V18H5M19,9H15V3H9V9H5L12,16L19,9Z" />
              </svg></a></td>
            </tr>
            {{ end }} {{ partial "pagination" . }}
            
          </tbody>
        </table>
      </div>
    </div>
    <div id="audio">
    </div>
  </div>
  {{ partial "footer.html" . }}
  </div>